<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />

  <title>Eng. Nicholas Gumbo | Governor of Siaya</title>
  <meta name="description" content="Campaign website for Eng. Nicholas Gumbo for Governor of Siaya County: vision, agenda, and a transparent sub-county dashboard with verified polling support." />
  <meta name="theme-color" content="#006600" />

  <!-- CSP (GitHub Pages friendly) -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 img-src 'self' data: https:;
                 style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
                 font-src https://fonts.gstatic.com data:;
                 script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net;
                 connect-src 'self' https:;
                 frame-src https://translate.google.com https://translate.googleapis.com;
                 base-uri 'self';
                 form-action 'self';
                 object-src 'none';
                 frame-ancestors 'none';
                 upgrade-insecure-requests">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      /* Kenya flag colors */
      --ke-black:#000000;
      --ke-red:#BB0000;
      --ke-green:#006600;
      --ke-white:#FFFFFF;

      /* Siaya-inspired accent (gold + green) */
      --siaya-green:#48B038;
      --siaya-gold:#D08810;

      --brand: var(--ke-green);
      --brand2: var(--ke-red);
      --brand3: var(--siaya-gold);

      --bg:#070A10;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.08);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --muted2: rgba(255,255,255,.55);
      --border: rgba(255,255,255,.12);
      --shadow: 0 24px 60px rgba(0,0,0,.45);

      --radius: 18px;
      --radius2: 26px;
      --max: 1180px;

      --focus: 0 0 0 4px rgba(0,102,0,.35);
      --fz: 16px;
    }
    [data-theme="light"]{
      --bg:#f6f8ff;
      --card:#ffffff;
      --card2:#f1f5ff;
      --text:#0b1020;
      --muted: rgba(11,16,32,.72);
      --muted2: rgba(11,16,32,.55);
      --border: rgba(11,16,32,.12);
      --shadow: 0 22px 46px rgba(2,6,23,.12);
      --focus: 0 0 0 4px rgba(187,0,0,.25);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-size:var(--fz);
      line-height:1.55;
      color:var(--text);
      background:
        radial-gradient(1100px 700px at 12% 10%, rgba(72,176,56,.22), transparent 55%),
        radial-gradient(1000px 700px at 85% 18%, rgba(187,0,0,.18), transparent 55%),
        radial-gradient(900px 650px at 55% 85%, rgba(208,136,16,.14), transparent 58%),
        var(--bg);
      overflow-x:hidden;
    }
    a{ color:inherit; text-decoration:none; }
    a:hover{ text-decoration:underline; text-underline-offset:4px; }
    img{ max-width:100%; display:block; }

    .wrap{ max-width:var(--max); margin:0 auto; padding:0 18px; }
    .skip{ position:absolute; left:-999px; top:auto; width:1px; height:1px; overflow:hidden; }
    .skip:focus{
      left:16px; top:16px; width:auto; height:auto; overflow:visible;
      background:var(--card); border:1px solid var(--border);
      padding:10px 12px; border-radius:12px; box-shadow:var(--shadow);
      outline:none;
    }

    header{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(12px);
      background: linear-gradient(to bottom, rgba(0,0,0,.55), rgba(0,0,0,.12));
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    [data-theme="light"] header{
      background: linear-gradient(to bottom, rgba(246,248,255,.90), rgba(246,248,255,.65));
      border-bottom:1px solid rgba(11,16,32,.10);
    }
    .nav{
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 0; gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:12px; min-width:260px;
    }
    .logo{
      width:40px; height:40px; border-radius:14px;
      background: linear-gradient(135deg, var(--ke-black) 0 20%, var(--ke-red) 20% 45%, var(--ke-white) 45% 52%, var(--ke-green) 52% 100%);
      box-shadow: 0 18px 35px rgba(0,102,0,.25);
      border:1px solid rgba(255,255,255,.14);
    }
    [data-theme="light"] .logo{ border:1px solid rgba(11,16,32,.12); }

    .brand h1{
      font-size:14px; margin:0; letter-spacing:.2px;
      display:flex; flex-direction:column; line-height:1.15;
    }
    .brand h1 span:first-child{ font-weight:900; font-size:14px; }
    .brand h1 span:last-child{ font-weight:700; font-size:12px; color:var(--muted); }

    nav ul{
      list-style:none; margin:0; padding:0;
      display:flex; align-items:center; gap:8px; flex-wrap:wrap; justify-content:center;
    }
    nav a{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px; border-radius:14px;
      border:1px solid transparent; color:var(--muted); font-weight:750;
    }
    nav a:hover{
      text-decoration:none; border-color:rgba(255,255,255,.14);
      background:rgba(255,255,255,.06); color:var(--text);
    }
    [data-theme="light"] nav a:hover{
      border-color:rgba(11,16,32,.12);
      background:rgba(11,16,32,.04);
    }
    nav a[aria-current="page"]{
      background:linear-gradient(135deg, rgba(0,102,0,.25), rgba(187,0,0,.18));
      border-color:rgba(0,102,0,.28);
      color:var(--text);
    }

    .actions{ display:flex; align-items:center; gap:10px; justify-content:flex-end; min-width:260px; }
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      padding:10px 12px; border-radius:14px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      color:var(--text); font-weight:850;
      cursor:pointer; user-select:none;
    }
    .btn:hover{ background:rgba(255,255,255,.10); }
    [data-theme="light"] .btn{ background:#fff; }
    [data-theme="light"] .btn:hover{ background:rgba(11,16,32,.04); }
    .btn:focus{ outline:none; box-shadow:var(--focus); }

    .btn.primary{
      border-color: rgba(0,102,0,.35);
      background: linear-gradient(135deg, rgba(0,102,0,.45), rgba(187,0,0,.25));
    }
    .btn.primary:hover{ background: linear-gradient(135deg, rgba(0,102,0,.55), rgba(187,0,0,.30)); }

    .pill{
      display:inline-flex; align-items:center; gap:10px;
      padding:8px 10px; border-radius:999px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      color:var(--muted); font-weight:750; white-space:nowrap;
    }

    section{ padding:18px 0; }
    .hero{ padding:44px 0 18px; }
    .heroGrid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:18px;
      align-items:stretch;
    }
    @media (max-width: 980px){ .heroGrid{ grid-template-columns:1fr; } .brand,.actions{ min-width:auto; } }

    .card{
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    [data-theme="light"] .card{ background: linear-gradient(180deg, #ffffff, #f9fbff); }
    .cardPad{ padding:22px; }

    .headline{
      font-size: clamp(28px, 3.2vw, 46px);
      line-height:1.06;
      margin:10px 0 12px;
      letter-spacing:-.8px;
      font-weight:950;
    }
    .subhead{
      color:var(--muted);
      font-size: clamp(14px, 1.4vw, 17px);
      max-width: 72ch;
      margin:0 0 16px;
      font-weight:650;
    }

    .kpis{ display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-top:16px; }
    @media (max-width: 680px){ .kpis{ grid-template-columns:1fr; } nav ul{ justify-content:flex-start; } }
    .kpi{ border:1px solid var(--border); background:rgba(255,255,255,.06); border-radius:18px; padding:14px; }
    [data-theme="light"] .kpi{ background:rgba(11,16,32,.03); }
    .kpi .n{ font-size:22px; font-weight:950; letter-spacing:-.4px; }
    .kpi .l{ color:var(--muted); font-weight:700; font-size:12px; margin-top:4px; }

    .slideshow{
      min-height: 320px;
      border-radius: var(--radius2);
      border:1px solid var(--border);
      position:relative;
      overflow:hidden;
      background:#000;
    }
    .slide{
      position:absolute; inset:0;
      background-size:cover;
      background-position:center;
      opacity:0;
      transition: opacity .9s ease;
      filter: saturate(1.05) contrast(1.02);
    }
    .slide.on{ opacity:.90; }
    .overlay{
      position:absolute; inset:0;
      background:
        linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.65)),
        radial-gradient(900px 500px at 20% 20%, rgba(0,102,0,.30), transparent 55%),
        radial-gradient(900px 500px at 80% 20%, rgba(187,0,0,.24), transparent 55%),
        radial-gradient(900px 500px at 50% 90%, rgba(208,136,16,.20), transparent 58%);
    }
    .slideshow .badge{ position:absolute; left:16px; top:16px; }
    .slideshow .caption{
      position:absolute; left:16px; right:16px; bottom:16px;
      display:flex; flex-direction:column; gap:8px;
    }
    .caption .name{ font-weight:950; letter-spacing:-.4px; font-size:18px; }
    .caption .title{ color:var(--muted); font-weight:750; font-size:13px; }
    .caption .ctaRow{ display:flex; gap:10px; flex-wrap:wrap; margin-top:6px; }
    .mini{ font-size:12px; color:var(--muted2); font-weight:700; }

    .sectionTitle{ display:flex; align-items:flex-end; justify-content:space-between; gap:14px; margin:10px 0 12px; }
    .sectionTitle h2{ margin:0; font-size: clamp(20px, 2vw, 28px); letter-spacing:-.3px; font-weight:950; }
    .sectionTitle p{ margin:0; color:var(--muted); max-width:70ch; font-weight:650; font-size:13px; }

    .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap:14px; }
    @media (max-width: 900px){ .grid2{ grid-template-columns:1fr; } }

    .list{ margin:0; padding:0; list-style:none; display:flex; flex-direction:column; gap:10px; }
    .li{
      display:flex; gap:12px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      border-radius:18px; padding:14px;
      align-items:flex-start;
    }
    [data-theme="light"] .li{ background:rgba(11,16,32,.03); }
    .dot{
      width:10px; height:10px; border-radius:99px; margin-top:6px;
      background: var(--brand);
      box-shadow: 0 0 0 4px rgba(0,102,0,.12);
      flex:0 0 auto;
    }
    .li h3{ margin:0 0 4px; font-size:14px; font-weight:950; }
    .li p{ margin:0; color:var(--muted); font-weight:650; font-size:13px; }

    /* Dashboard */
    .dashTop{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between; margin-bottom:12px; }
    .controls{ display:flex; flex-wrap:wrap; gap:10px; align-items:flex-end; }
    select, input[type="search"], input[type="text"], textarea{
      width:100%;
      border-radius:14px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding:10px 12px;
      font: inherit;
      outline:none;
    }
    [data-theme="light"] select,
    [data-theme="light"] input[type="search"],
    [data-theme="light"] input[type="text"],
    [data-theme="light"] textarea{ background:#fff; }
    select:focus, input:focus, textarea:focus{ box-shadow:var(--focus); }
    label{ font-size:12px; color:var(--muted); font-weight:900; display:block; margin:0 0 6px; }

    .tableWrap{
      overflow:auto;
      border-radius:18px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.04);
    }
    [data-theme="light"] .tableWrap{ background:rgba(11,16,32,.02); }
    table{ border-collapse:separate; border-spacing:0; width:100%; min-width:1040px; }
    th, td{ text-align:left; padding:12px 12px; border-bottom:1px solid var(--border); font-size:13px; vertical-align:top; }
    th{
      position:sticky; top:0;
      background: rgba(0,0,0,.25);
      backdrop-filter: blur(10px);
      color: var(--muted);
      font-weight:950;
      letter-spacing:.2px;
      z-index:2;
    }
    [data-theme="light"] th{ background: rgba(246,248,255,.90); }
    tr:hover td{ background: rgba(255,255,255,.04); }
    [data-theme="light"] tr:hover td{ background: rgba(11,16,32,.03); }

    .tag{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      font-weight:950;
      font-size:12px;
      white-space:nowrap;
    }
    .tag.good{ border-color:rgba(0,102,0,.45); background:rgba(0,102,0,.14); }
    .tag.mid{ border-color:rgba(208,136,16,.45); background:rgba(208,136,16,.14); }
    .tag.low{ border-color:rgba(187,0,0,.45); background:rgba(187,0,0,.14); }
    .tag.neutral{ border-color:rgba(255,255,255,.22); background:rgba(255,255,255,.08); color:var(--muted); }

    .badgeLead{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(0,102,0,.45);
      background: linear-gradient(135deg, rgba(0,102,0,.24), rgba(208,136,16,.14));
      font-weight:950;
      font-size:12px;
      white-space:nowrap;
    }
    .hr{ height:1px; background:var(--border); margin:18px 0; }

    footer{ padding:28px 0 40px; color:var(--muted); font-size:13px; }

    .toast{
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
      background:rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.14);
      color:#fff; padding:10px 12px; border-radius:14px;
      box-shadow:var(--shadow); opacity:0; pointer-events:none;
      transition: opacity .25s ease; max-width:min(720px, calc(100vw - 36px)); z-index:60;
      font-weight:750;
    }
    [data-theme="light"] .toast{ background:rgba(11,16,32,.70); }
    .toast.show{ opacity:1; }

    .hint{
      border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      border-radius:18px;
      padding:12px 14px;
      font-size:13px;
      color:var(--muted);
      font-weight:700;
    }

    .filebox{
      display:grid;
      gap:8px;
      min-width:280px;
    }
    .filebox input[type="file"]{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      color: var(--text);
    }

    :focus-visible{ outline:none; box-shadow: var(--focus); border-radius:12px; }
  </style>
</head>

<body data-theme="dark">
  <a class="skip" href="#main">Skip to content</a>

  <header>
    <div class="wrap nav">
      <div class="brand" aria-label="Campaign brand">
        <div class="logo" aria-hidden="true"></div>
        <h1>
          <span>Eng. Nicholas Gumbo</span>
          <span>Governor of Siaya ‚Ä¢ Campaign HQ</span>
        </h1>
      </div>

      <nav aria-label="Primary">
        <ul>
          <li><a href="#home" aria-current="page">Home</a></li>
          <li><a href="#vision">Vision</a></li>
          <li><a href="#dashboard">Sub-County Stats</a></li>
          <li><a href="#agenda">Agenda</a></li>
          <li><a href="#getinvolved">Get Involved</a></li>
        </ul>
      </nav>

      <div class="actions">
        <button class="btn" id="themeBtn" type="button" aria-label="Toggle theme">üåó Theme</button>
        <a class="btn primary" href="#getinvolved" role="button">Join the Movement</a>
      </div>
    </div>
  </header>

  <main id="main">
    <!-- HERO -->
    <section class="hero" id="home">
      <div class="wrap heroGrid">
        <article class="card">
          <div class="cardPad">
            <span class="pill">Kenya colors ‚Ä¢ Siaya identity ‚Ä¢ Verified polling support</span>
            <h2 class="headline">A stronger, fairer Siaya‚Äîbuilt on delivery, transparency, and unity.</h2>
            <p class="subhead">
              This site includes a sub-county dashboard. You can upload a JSON/CSV poll file and the system will:
              <strong>auto-cite sources</strong> and show a <strong>Leading</strong> badge only when the source supports it.
            </p>

            <div class="kpis" aria-label="Top metrics">
              <div class="kpi">
                <div class="n">6</div>
                <div class="l">Sub-counties covered (Alego Usonga, Bondo, Gem, Rarieda, Ugenya, Ugunja)</div>
              </div>
              <div class="kpi">
                <div class="n">Fast</div>
                <div class="l">Static + mobile-first (perfect for GitHub Pages)</div>
              </div>
              <div class="kpi">
                <div class="n">Proof</div>
                <div class="l">‚ÄúLeading‚Äù badge requires a non-empty source URL + margin rule</div>
              </div>
            </div>

            <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:14px;">
              <a class="btn primary" href="#dashboard">View Dashboard</a>
              <a class="btn" href="#agenda">Read Agenda</a>
            </div>

            <div class="hint" style="margin-top:14px;">
              <strong>Important:</strong> ‚ÄúLeading‚Äù is only shown when:
              Gumbo % is highest <em>and</em> margin ‚â• 2.0 <em>and</em> methodology rating is A/B <em>and</em> source URL exists.
            </div>
          </div>
        </article>

        <aside class="card slideshow" aria-label="Campaign gallery slideshow">
          <div class="slide on" style="background-image:url('1.jpg')"></div>
          <div class="slide" style="background-image:url('2.jpg')"></div>
          <div class="slide" style="background-image:url('3.jpg')"></div>
          <div class="slide" style="background-image:url('4.jpg')"></div>
          <div class="slide" style="background-image:url('5.jpg')"></div>
          <div class="slide" style="background-image:url('6.jpg')"></div>
          <div class="slide" style="background-image:url('7.jpg')"></div>
          <div class="overlay" aria-hidden="true"></div>

          <div class="badge pill">From your repo images (1.jpg‚Äì7.jpg)</div>
          <div class="caption">
            <div class="name">Eng. Nicholas Gumbo</div>
            <div class="title">Governor of Siaya ‚Ä¢ People ‚Ä¢ Delivery ‚Ä¢ Integrity</div>
            <div class="ctaRow">
              <a class="btn primary" href="#getinvolved" role="button">Volunteer</a>
              <a class="btn" href="#vision" role="button">Our Vision</a>
            </div>
            <div class="mini">Tip: Add a campaign logo as <strong>logo.png</strong> and wire it in.</div>
          </div>
        </aside>
      </div>
    </section>

    <!-- TRANSLATE -->
    <section>
      <div class="wrap">
        <div class="card">
          <div class="cardPad">
            <div class="sectionTitle" style="margin:0 0 10px;">
              <h2 style="margin:0;">Translate</h2>
              <p style="margin:0;">Google Translate widget for global visitors.</p>
            </div>
            <div id="google_translate_element" aria-label="Google Translate widget"></div>
            <div class="mini" style="margin-top:10px;">
              If translate doesn‚Äôt load, ensure your browser allows translate.google.com frames.
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- VISION -->
    <section id="vision">
      <div class="wrap">
        <div class="sectionTitle">
          <h2>Vision for Siaya</h2>
          <p>Clear priorities + measurable outcomes in every sub-county.</p>
        </div>

        <div class="grid2">
          <div class="card">
            <div class="cardPad">
              <ul class="list">
                <li class="li">
                  <span class="dot" aria-hidden="true"></span>
                  <div>
                    <h3>Transparent service delivery</h3>
                    <p>Public project tracker: budgets, timelines, progress updates‚Äîmonthly reporting.</p>
                  </div>
                </li>
                <li class="li">
                  <span class="dot" aria-hidden="true" style="background:var(--ke-red); box-shadow:0 0 0 4px rgba(187,0,0,.12);"></span>
                  <div>
                    <h3>Jobs & enterprise</h3>
                    <p>Agriculture value chains, MSMEs, youth skills, and practical financing access.</p>
                  </div>
                </li>
                <li class="li">
                  <span class="dot" aria-hidden="true" style="background:var(--siaya-gold); box-shadow:0 0 0 4px rgba(208,136,16,.14);"></span>
                  <div>
                    <h3>Health, water, roads</h3>
                    <p>Primary care, reliable water points, and passable roads that unlock trade.</p>
                  </div>
                </li>
              </ul>
            </div>
          </div>

          <div class="card">
            <div class="cardPad">
              <h3 style="margin:0 0 10px; font-size:16px; font-weight:950;">Data policy (simple)</h3>
              <p class="subhead" style="margin:0 0 12px;">
                This site supports strong campaigning while staying credible:
                attach sources for polling per sub-county. ‚ÄúLeading‚Äù only appears when the source supports it.
              </p>
              <div class="li">
                <span class="dot" aria-hidden="true" style="background:var(--ke-black); box-shadow:0 0 0 4px rgba(255,255,255,.10);"></span>
                <div>
                  <h3>What counts as ‚ÄúVerified‚Äù</h3>
                  <p>A published poll/report link + fieldwork dates + sample size + methodology rating.</p>
                </div>
              </div>
              <div class="hr"></div>
              <div class="mini">
                Sub-counties: Alego Usonga, Bondo, Gem, Rarieda, Ugenya, Ugunja.
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- DASHBOARD -->
    <section id="dashboard">
      <div class="wrap">
        <div class="sectionTitle">
          <h2>Sub-County Dashboard</h2>
          <p>Includes Polling (Verified), auto-cites sources, and shows ‚ÄúLeading‚Äù only when supported.</p>
        </div>

        <div class="card">
          <div class="cardPad">
            <div class="dashTop">
              <div class="controls" style="flex:1; min-width:260px;">
                <div style="min-width:260px; flex:1;">
                  <label for="metric">Metric</label>
                  <select id="metric">
                    <option value="polling">Polling (Verified) ‚Äî Gumbo %</option>
                    <option value="margin">Polling Margin (Gumbo - Runner-up)</option>
                    <option value="csi">Campaign Strength Index (Internal)</option>
                    <option value="groundGame">Ground Game (Internal)</option>
                    <option value="volunteerNetwork">Volunteer Network (Internal)</option>
                    <option value="messageClarity">Message Clarity (Internal)</option>
                  </select>
                </div>

                <div style="min-width:260px; flex:1;">
                  <label for="search">Search sub-county</label>
                  <input id="search" type="search" placeholder="Type: Bondo, Gem..." />
                </div>

                <div class="filebox">
                  <label for="importFile">Import Poll File (JSON/CSV)</label>
                  <input id="importFile" type="file" accept=".json,.csv,application/json,text/csv" />
                </div>
              </div>

              <div class="controls">
                <button class="btn" id="downloadJson" type="button">‚¨áÔ∏è Export JSON</button>
                <button class="btn" id="resetDemo" type="button">‚Ü©Ô∏è Reset Demo</button>
              </div>
            </div>

            <div class="grid2" style="margin-top:12px;">
              <div class="card" style="box-shadow:none;">
                <div class="cardPad">
                  <h3 style="margin:0 0 10px; font-size:16px; font-weight:950;">Chart</h3>
                  <canvas id="chart" height="170" aria-label="Metric chart" role="img"></canvas>
                  <div class="mini" style="margin-top:8px;">
                    If you import a poll file, the chart updates automatically. ‚ÄúLeading‚Äù is based on strict rules.
                  </div>
                </div>
              </div>

              <div class="card" style="box-shadow:none;">
                <div class="cardPad">
                  <h3 style="margin:0 0 10px; font-size:16px; font-weight:950;">Leading badge rules</h3>
                  <ul class="list">
                    <li class="li">
                      <span class="dot" aria-hidden="true"></span>
                      <div>
                        <h3>1) Gumbo must be highest</h3>
                        <p>Gumbo % must be greater than runner-up % for that sub-county.</p>
                      </div>
                    </li>
                    <li class="li">
                      <span class="dot" aria-hidden="true" style="background:var(--siaya-gold); box-shadow:0 0 0 4px rgba(208,136,16,.14);"></span>
                      <div>
                        <h3>2) Margin must be meaningful</h3>
                        <p>Margin (Gumbo - runner-up) must be at least <strong>2.0</strong>.</p>
                      </div>
                    </li>
                    <li class="li">
                      <span class="dot" aria-hidden="true" style="background:var(--ke-red); box-shadow:0 0 0 4px rgba(187,0,0,.12);"></span>
                      <div>
                        <h3>3) Source must exist</h3>
                        <p>Source URL must be present + methodology rating must be A or B.</p>
                      </div>
                    </li>
                  </ul>

                  <div class="hint" style="margin-top:12px;">
                    If your poll is real and published, paste the link in the source URL field (or import it via JSON/CSV).
                  </div>
                </div>
              </div>
            </div>

            <div class="hr"></div>

            <h3 style="margin:0 0 10px; font-size:16px; font-weight:950;">Sub-county table (auto-cites sources)</h3>

            <div class="tableWrap">
              <table>
                <thead>
                  <tr>
                    <th>Sub-county</th>
                    <th>Polling (Verified)</th>
                    <th>Margin</th>
                    <th>Leading</th>
                    <th>Poll details</th>
                    <th>Source (auto-cite)</th>
                    <th>Internal CSI</th>
                    <th>Notes</th>
                  </tr>
                </thead>
                <tbody id="tbody"></tbody>
              </table>
            </div>

            <div class="mini" style="margin-top:10px;">
              Demo data is included. Import your JSON/CSV when ready.
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- AGENDA -->
    <section id="agenda">
      <div class="wrap">
        <div class="sectionTitle">
          <h2>Agenda</h2>
          <p>Practical deliverables that citizens can measure.</p>
        </div>

        <div class="grid2">
          <div class="card">
            <div class="cardPad">
              <ul class="list">
                <li class="li">
                  <span class="dot" aria-hidden="true"></span>
                  <div>
                    <h3>Service Delivery Tracker</h3>
                    <p>Project transparency portal and monthly progress updates.</p>
                  </div>
                </li>
                <li class="li">
                  <span class="dot" aria-hidden="true" style="background:var(--ke-red); box-shadow:0 0 0 4px rgba(187,0,0,.12);"></span>
                  <div>
                    <h3>Jobs, MSMEs, Agriculture</h3>
                    <p>Value-add chains, market access, and youth upskilling.</p>
                  </div>
                </li>
                <li class="li">
                  <span class="dot" aria-hidden="true" style="background:var(--siaya-gold); box-shadow:0 0 0 4px rgba(208,136,16,.14);"></span>
                  <div>
                    <h3>Health + Water + Roads</h3>
                    <p>Quick wins plus long-term infrastructure maintenance plan.</p>
                  </div>
                </li>
              </ul>
            </div>
          </div>

          <div class="card">
            <div class="cardPad">
              <h3 style="margin:0 0 10px; font-size:16px; font-weight:950;">Messaging pillars</h3>
              <p class="subhead" style="margin:0 0 10px;">
                Keep it simple: <strong>People ‚Ä¢ Delivery ‚Ä¢ Integrity</strong>. Add short stories from each sub-county.
              </p>
              <div class="li">
                <span class="dot" aria-hidden="true" style="background:var(--ke-black); box-shadow:0 0 0 4px rgba(255,255,255,.10);"></span>
                <div>
                  <h3>Respectful campaigning</h3>
                  <p>Win with ideas, evidence, and unity across Siaya.</p>
                </div>
              </div>
              <div class="hr"></div>
              <div class="mini">Add: manifesto PDF, press kit, endorsements (with permission), and event calendar.</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- GET INVOLVED -->
    <section id="getinvolved">
      <div class="wrap">
        <div class="sectionTitle">
          <h2>Get involved</h2>
          <p>Volunteer, host a meeting, or submit verified data sources for the dashboard.</p>
        </div>

        <div class="card">
          <div class="cardPad" style="display:grid; grid-template-columns:1.15fr .85fr; gap:14px;">
            <div>
              <h3 style="margin:0 0 8px; font-size:16px; font-weight:950;">Volunteer form (demo)</h3>
              <p class="mini" style="margin:0 0 12px;">
                GitHub Pages is static‚Äîthis demo stores to your browser only. For real collection, connect a form service.
              </p>

              <div class="grid2" style="gap:12px;">
                <div>
                  <label for="name">Full name</label>
                  <input id="name" type="text" placeholder="Your name" autocomplete="name" />
                </div>
                <div>
                  <label for="phone">Phone</label>
                  <input id="phone" type="text" placeholder="+254..." autocomplete="tel" />
                </div>
              </div>

              <div style="margin-top:12px;">
                <label for="subcounty">Sub-county</label>
                <select id="subcounty">
                  <option>Alego Usonga</option>
                  <option>Bondo</option>
                  <option>Gem</option>
                  <option>Rarieda</option>
                  <option>Ugenya</option>
                  <option>Ugunja</option>
                </select>
              </div>

              <div style="margin-top:12px;">
                <label for="msg">How would you like to help?</label>
                <textarea id="msg" rows="4" placeholder="Volunteer, host meeting, share verified data sources, etc."></textarea>
              </div>

              <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
                <button class="btn primary" id="saveVolunteer" type="button">Save locally</button>
                <button class="btn" id="clearVolunteer" type="button">Clear</button>
              </div>

              <div class="mini" style="margin-top:10px;" id="volStatus" aria-live="polite"></div>
            </div>

            <div>
              <h3 style="margin:0 0 8px; font-size:16px; font-weight:950;">Contacts & Links</h3>
              <div class="li">
                <span class="dot" aria-hidden="true"></span>
                <div>
                  <h3>Campaign HQ</h3>
                  <p>Add official phone, email, office address, and socials here.</p>
                </div>
              </div>
              <div class="li" style="margin-top:10px;">
                <span class="dot" aria-hidden="true" style="background:var(--ke-red); box-shadow:0 0 0 4px rgba(187,0,0,.12);"></span>
                <div>
                  <h3>Press kit</h3>
                  <p>Upload PDFs: manifesto, bio, photos, policy briefs‚Äîthen link them.</p>
                </div>
              </div>
              <div class="li" style="margin-top:10px;">
                <span class="dot" aria-hidden="true" style="background:var(--siaya-gold); box-shadow:0 0 0 4px rgba(208,136,16,.14);"></span>
                <div>
                  <h3>Verified polling</h3>
                  <p>Import JSON/CSV or paste links in the table to auto-cite sources.</p>
                </div>
              </div>

              <div class="hr"></div>
              <div class="mini">
                Disclaimer: Ensure compliance with electoral/advertising rules and avoid false claims.
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="wrap">
      <div class="hr"></div>
      <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:space-between; align-items:center;">
        <div>¬© <span id="year"></span> Eng. Nicholas Gumbo Campaign ‚Ä¢ Siaya County</div>
        <div class="mini">GitHub Pages ready ‚Ä¢ Polling (Verified) ‚Ä¢ Auto-cites sources ‚Ä¢ Leading badge rules</div>
      </div>
    </div>
  </footer>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- Google Translate -->
  <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

  <script>
    // Google Translate
    function googleTranslateElementInit() {
      try{
        new google.translate.TranslateElement(
          { pageLanguage: 'en', layout: google.translate.TranslateElement.InlineLayout.SIMPLE },
          'google_translate_element'
        );
      }catch(e){}
    }

    const $ = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => [...r.querySelectorAll(s)];
    const toastEl = $("#toast");

    function toast(msg){
      toastEl.textContent = msg;
      toastEl.classList.add("show");
      setTimeout(()=>toastEl.classList.remove("show"), 2400);
    }

    // Theme
    $("#themeBtn").addEventListener("click", ()=>{
      const t = document.body.getAttribute("data-theme") === "dark" ? "light" : "dark";
      document.body.setAttribute("data-theme", t);
      localStorage.setItem("theme", t);
      toast(`Theme: ${t}`);
    });
    (function initTheme(){
      const t = localStorage.getItem("theme");
      if(t) document.body.setAttribute("data-theme", t);
    })();

    // Slideshow
    const slides = $$(".slide");
    let si = 0;
    setInterval(()=>{
      slides[si].classList.remove("on");
      si = (si + 1) % slides.length;
      slides[si].classList.add("on");
    }, 4500);

    // ---------- DATA MODEL ----------
    // Polling is ‚ÄúVerified‚Äù only when source_url exists + methodology_rating A/B.
    // ‚ÄúLeading‚Äù badge only when:
    //  - gumbo_percent is highest vs runner_up_percent
    //  - margin >= 2.0
    //  - methodology_rating in A/B
    //  - source_url not empty
    const SUBCOUNTIES = ["Alego Usonga","Bondo","Gem","Rarieda","Ugenya","Ugunja"];

    // Demo polling (placeholders). Replace URLs with real published sources.
    const DEMO = SUBCOUNTIES.map((name, i) => {
      const base = [44.2, 46.8, 43.5, 41.0, 45.1, 42.7][i];
      const runner = [39.6, 42.9, 41.9, 39.2, 40.6, 41.2][i];
      return {
        name,
        polling: {
          gumbo_percent: base,
          runner_up_name: ["Opponent A","Opponent B","Opponent A","Opponent C","Opponent B","Opponent C"][i],
          runner_up_percent: runner,
          others_percent: Math.max(0, Math.round((100 - base - runner) * 10) / 10),
          fieldwork_start: "2026-02-10",
          fieldwork_end: "2026-02-14",
          sample_size: [620, 590, 605, 575, 610, 585][i],
          margin_error: [3.9, 4.0, 4.0, 4.1, 3.9, 4.0][i],
          methodology_rating: (i % 2 === 0 ? "A" : "B"),
          source_publisher: "Example Research Ltd",
          source_title: `Siaya Gubernatorial Poll ‚Äì ${name}`,
          source_url: "",  // IMPORTANT: leave empty until you have a real published link
          source_notes: "Paste a real published poll URL + methodology."
        },
        internal: {
          csi: [84, 86, 85, 82, 86, 83][i],
          groundGame: [86, 85, 87, 84, 86, 84][i],
          volunteerNetwork: [83, 82, 84, 81, 83, 81][i],
          messageClarity: [85, 84, 86, 83, 85, 83][i]
        },
        notes: "Demo record. Import JSON/CSV when ready."
      };
    });

    // ---------- STORAGE ----------
    const LS_KEY = "gumbo_siaya_dashboard_verified_v1";

    function loadData(){
      const raw = localStorage.getItem(LS_KEY);
      if(!raw) return structuredClone(DEMO);
      try{
        const parsed = JSON.parse(raw);
        if(Array.isArray(parsed) && parsed.length) return normalizeData(parsed);
        return structuredClone(DEMO);
      }catch(e){
        return structuredClone(DEMO);
      }
    }

    function saveData(){
      localStorage.setItem(LS_KEY, JSON.stringify(state.data, null, 2));
    }

    function normalizeData(arr){
      // Ensure all subcounties exist; keep user data where available
      const byName = new Map(arr.map(x => [x.name, x]));
      return SUBCOUNTIES.map(n => {
        const x = byName.get(n);
        if(!x) return structuredClone(DEMO.find(d=>d.name===n));
        // Merge with defaults to avoid missing fields
        const def = structuredClone(DEMO.find(d=>d.name===n));
        return {
          name: n,
          polling: { ...def.polling, ...(x.polling || {}) },
          internal: { ...def.internal, ...(x.internal || {}) },
          notes: (x.notes ?? def.notes)
        };
      });
    }

    const state = {
      data: loadData(),
      metric: "polling",
      search: ""
    };

    // ---------- HELPERS ----------
    function esc(s){
      return String(s ?? "").replace(/[&<>"']/g, m => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m]));
    }
    function toNum(x){
      const n = Number(x);
      return Number.isFinite(n) ? n : 0;
    }
    function pollingMargin(row){
      return Math.round((toNum(row.polling.gumbo_percent) - toNum(row.polling.runner_up_percent)) * 10) / 10;
    }
    function isVerifiedPoll(row){
      const r = String(row.polling.methodology_rating || "").toUpperCase().trim();
      const url = String(row.polling.source_url || "").trim();
      return url.length > 0 && (r === "A" || r === "B");
    }
    function showLeadingBadge(row){
      const margin = pollingMargin(row);
      const gumbo = toNum(row.polling.gumbo_percent);
      const runner = toNum(row.polling.runner_up_percent);
      return isVerifiedPoll(row) && gumbo > runner && margin >= 2.0;
    }

    // ---------- RENDER TABLE ----------
    const tbody = $("#tbody");

    function statusTagForPolling(row){
      if(!isVerifiedPoll(row)) return `<span class="tag neutral">Unverified</span>`;
      if(showLeadingBadge(row)) return `<span class="tag good">Verified</span>`;
      return `<span class="tag mid">Verified</span>`;
    }

    function metricValue(row, key){
      if(key === "polling") return toNum(row.polling.gumbo_percent);
      if(key === "margin") return pollingMargin(row);
      if(key === "csi") return toNum(row.internal.csi);
      if(key === "groundGame") return toNum(row.internal.groundGame);
      if(key === "volunteerNetwork") return toNum(row.internal.volunteerNetwork);
      if(key === "messageClarity") return toNum(row.internal.messageClarity);
      return 0;
    }

    function metricLabel(key){
      return ({
        polling: "Polling (Verified) ‚Äî Gumbo %",
        margin: "Polling Margin (Gumbo - Runner-up)",
        csi: "Campaign Strength Index (Internal)",
        groundGame: "Ground Game (Internal)",
        volunteerNetwork: "Volunteer Network (Internal)",
        messageClarity: "Message Clarity (Internal)"
      })[key] || key;
    }

    function rowHtml(row, idx){
      const margin = pollingMargin(row);
      const lead = showLeadingBadge(row);
      const verified = isVerifiedPoll(row);

      const url = String(row.polling.source_url || "").trim();
      const sourceLink = url
        ? `<a href="${esc(url)}" target="_blank" rel="noopener">${esc(row.polling.source_publisher || "Source")}</a>`
        : `<span class="mini">Add source URL</span>`;

      const details = `
        <div class="mini">
          Fieldwork: ${esc(row.polling.fieldwork_start)} ‚Üí ${esc(row.polling.fieldwork_end)}<br/>
          Sample: ${esc(row.polling.sample_size)} ‚Ä¢ ¬±${esc(row.polling.margin_error)} ‚Ä¢ Rating: <strong>${esc(row.polling.methodology_rating)}</strong><br/>
          Runner-up: ${esc(row.polling.runner_up_name)} (${esc(row.polling.runner_up_percent)}%)
        </div>
      `;

      const leadBadge = lead ? `<span class="badgeLead">‚úÖ Leading (Verified)</span>` : `<span class="mini">‚Äî</span>`;

      return `
        <tr>
          <td><strong>${esc(row.name)}</strong><br/>${statusTagForPolling(row)}</td>

          <td>
            <strong>${esc(row.polling.gumbo_percent)}%</strong><br/>
            <span class="mini">${verified ? "Verified (source present)" : "Not verified (no source URL)"}</span>
          </td>

          <td><strong>${esc(margin)}%</strong></td>
          <td>${leadBadge}</td>

          <td>${details}</td>

          <td>
            <div style="display:grid; gap:8px; min-width:300px;">
              <div>${sourceLink}</div>
              <div class="mini"><strong>${esc(row.polling.source_title || "")}</strong></div>

              <input type="text" placeholder="Source URL (required for Verified/Leading badge)"
                value="${esc(url)}" data-idx="${idx}" data-field="polling.source_url" />

              <input type="text" placeholder="Publisher (e.g., pollster/media)"
                value="${esc(row.polling.source_publisher)}" data-idx="${idx}" data-field="polling.source_publisher" />

              <input type="text" placeholder="Title"
                value="${esc(row.polling.source_title)}" data-idx="${idx}" data-field="polling.source_title" />

              <input type="text" placeholder="Notes"
                value="${esc(row.polling.source_notes)}" data-idx="${idx}" data-field="polling.source_notes" />
            </div>
          </td>

          <td>
            <div style="display:grid; gap:8px; min-width:180px;">
              <label class="mini" style="margin:0;">CSI</label>
              <input type="text" value="${esc(row.internal.csi)}" data-idx="${idx}" data-field="internal.csi" />
              <label class="mini" style="margin:0;">Ground Game</label>
              <input type="text" value="${esc(row.internal.groundGame)}" data-idx="${idx}" data-field="internal.groundGame" />
              <label class="mini" style="margin:0;">Volunteer Net</label>
              <input type="text" value="${esc(row.internal.volunteerNetwork)}" data-idx="${idx}" data-field="internal.volunteerNetwork" />
              <label class="mini" style="margin:0;">Message</label>
              <input type="text" value="${esc(row.internal.messageClarity)}" data-idx="${idx}" data-field="internal.messageClarity" />
            </div>
          </td>

          <td>
            <input type="text" style="min-width:220px;"
              placeholder="General notes"
              value="${esc(row.notes)}" data-idx="${idx}" data-field="notes" />
          </td>
        </tr>
      `;
    }

    function renderTable(){
      const q = state.search.trim().toLowerCase();
      const filtered = state.data.filter(d => d.name.toLowerCase().includes(q));
      tbody.innerHTML = filtered.map(d => {
        const idx = state.data.findIndex(x=>x.name===d.name);
        return rowHtml(d, idx);
      }).join("");

      // Bind edits
      $$("input[data-field]", tbody).forEach(inp=>{
        inp.addEventListener("input", (e)=>{
          const idx = parseInt(e.target.getAttribute("data-idx"), 10);
          const field = e.target.getAttribute("data-field");
          if(Number.isNaN(idx) || !field) return;

          const val = e.target.value;

          setPath(state.data[idx], field, val);
          saveData();
          buildChart();
          // re-render lightly for badges/links updates
          renderTable();
        });
      });
    }

    function setPath(obj, path, value){
      const parts = path.split(".");
      let cur = obj;
      for(let i=0;i<parts.length-1;i++){
        const k = parts[i];
        if(typeof cur[k] !== "object" || cur[k] === null) cur[k] = {};
        cur = cur[k];
      }
      const last = parts[parts.length-1];
      // numeric fields auto-cast
      const numericFields = new Set([
        "gumbo_percent","runner_up_percent","others_percent","sample_size","margin_error",
        "csi","groundGame","volunteerNetwork","messageClarity"
      ]);
      if(numericFields.has(last)){
        const n = Number(value);
        cur[last] = Number.isFinite(n) ? n : value;
      }else{
        cur[last] = value;
      }
    }

    // ---------- CHART ----------
    let chart;
    function buildChart(){
      const ctx = $("#chart");
      const labels = state.data.map(d=>d.name);
      const vals = state.data.map(d=>metricValue(d, state.metric));

      if(chart) chart.destroy();
      chart = new Chart(ctx, {
        type: "bar",
        data: {
          labels,
          datasets: [{
            label: metricLabel(state.metric),
            data: vals,
            borderWidth: 1,
            borderRadius: 10
          }]
        },
        options: {
          responsive:true,
          maintainAspectRatio:false,
          plugins:{ legend:{ display:true } },
          scales:{ y:{ beginAtZero:true, suggestedMax: (state.metric==="polling" || state.metric==="margin") ? 60 : 100 } }
        }
      });
    }

    // ---------- CONTROLS ----------
    $("#metric").addEventListener("change", (e)=>{
      state.metric = e.target.value;
      buildChart();
      toast(`Metric: ${metricLabel(state.metric)}`);
    });
    $("#search").addEventListener("input", (e)=>{
      state.search = e.target.value;
      renderTable();
    });

    $("#downloadJson").addEventListener("click", ()=>{
      const payload = {
        generatedAt: new Date().toISOString(),
        county: "Siaya",
        note: "Leading badge requires: source_url + rating A/B + margin >= 2 + gumbo > runner_up.",
        data: state.data
      };
      const blob = new Blob([JSON.stringify(payload, null, 2)], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = "siaya-dashboard-export.json";
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
      toast("Exported JSON");
    });

    $("#resetDemo").addEventListener("click", ()=>{
      if(!confirm("Reset to demo data? This overwrites your saved edits in this browser.")) return;
      state.data = structuredClone(DEMO);
      localStorage.removeItem(LS_KEY);
      saveData();
      renderTable();
      buildChart();
      toast("Reset to demo");
    });

    // ---------- IMPORT JSON / CSV ----------
    $("#importFile").addEventListener("change", async (e)=>{
      const f = e.target.files && e.target.files[0];
      if(!f) return;

      try{
        const text = await f.text();
        if(f.name.toLowerCase().endsWith(".json")){
          const parsed = JSON.parse(text);
          // Accept either {subcounties:[...]} or {data:[...]} or direct array
          let arr = null;
          if(Array.isArray(parsed)) arr = parsed;
          else if(parsed && Array.isArray(parsed.subcounties)){
            // map sample format -> internal format
            arr = parsed.subcounties.map(s => ({
              name: s.name,
              polling: {
                gumbo_percent: s.polling_verified?.gumbo_percent ?? "",
                runner_up_name: s.polling_verified?.runner_up_name ?? "",
                runner_up_percent: s.polling_verified?.runner_up_percent ?? "",
                others_percent: s.polling_verified?.others_percent ?? "",
                fieldwork_start: s.polling_verified?.fieldwork_start ?? "",
                fieldwork_end: s.polling_verified?.fieldwork_end ?? "",
                sample_size: s.polling_verified?.sample_size ?? "",
                margin_error: s.polling_verified?.margin_error ?? "",
                methodology_rating: s.polling_verified?.methodology_rating ?? "",
                source_publisher: s.polling_verified?.source?.publisher ?? "",
                source_title: s.polling_verified?.source?.title ?? "",
                source_url: s.polling_verified?.source?.url ?? "",
                source_notes: s.polling_verified?.source?.notes ?? ""
              }
            }));
          } else if(parsed && Array.isArray(parsed.data)) arr = parsed.data;
          else arr = null;

          if(!arr) throw new Error("JSON format not recognized.");

          // Merge into current (keep internal fields)
          const merged = normalizeData(arr.map(x=>{
            const def = DEMO.find(d=>d.name===x.name) || null;
            return {
              name: x.name,
              polling: x.polling || x.polling_verified || x.polling_verified?.polling || x.polling_verified || x.polling || {},
              internal: x.internal || (def ? def.internal : {}),
              notes: x.notes || (def ? def.notes : "")
            };
          }));

          state.data = merged;
          saveData();
          renderTable();
          buildChart();
          toast("Imported JSON ‚úÖ");
        } else if(f.name.toLowerCase().endsWith(".csv")){
          const arr = parseCSV(text);
          // Expected columns:
          // SubCounty,GumboPercent,RunnerUpName,RunnerUpPercent,OthersPercent,FieldworkStart,FieldworkEnd,SampleSize,MarginError,MethodologyRating,SourcePublisher,SourceTitle,SourceURL,SourceNotes
          const mapped = arr.map(r => ({
            name: r.SubCounty || r.subcounty || r.Subcounty || "",
            polling: {
              gumbo_percent: r.GumboPercent ?? "",
              runner_up_name: r.RunnerUpName ?? "",
              runner_up_percent: r.RunnerUpPercent ?? "",
              others_percent: r.OthersPercent ?? "",
              fieldwork_start: r.FieldworkStart ?? "",
              fieldwork_end: r.FieldworkEnd ?? "",
              sample_size: r.SampleSize ?? "",
              margin_error: r.MarginError ?? "",
              methodology_rating: r.MethodologyRating ?? "",
              source_publisher: r.SourcePublisher ?? "",
              source_title: r.SourceTitle ?? "",
              source_url: r.SourceURL ?? "",
              source_notes: r.SourceNotes ?? ""
            }
          }));
          state.data = normalizeData(mapped);
          saveData();
          renderTable();
          buildChart();
          toast("Imported CSV ‚úÖ");
        } else {
          throw new Error("Only .json or .csv supported.");
        }
      }catch(err){
        console.error(err);
        toast(`Import failed: ${err.message || err}`);
      }finally{
        e.target.value = "";
      }
    });

    function parseCSV(text){
      const lines = text.replace(/\r/g,"").split("\n").filter(l=>l.trim().length);
      if(lines.length < 2) return [];
      const headers = splitCSVLine(lines[0]).map(h=>h.trim());
      const out = [];
      for(let i=1;i<lines.length;i++){
        const cols = splitCSVLine(lines[i]);
        const row = {};
        headers.forEach((h, idx)=> row[h] = (cols[idx] ?? "").trim());
        // numeric casting for known fields
        ["GumboPercent","RunnerUpPercent","OthersPercent","SampleSize","MarginError"].forEach(k=>{
          if(row[k] !== undefined && row[k] !== ""){
            const n = Number(row[k]);
            if(Number.isFinite(n)) row[k] = n;
          }
        });
        out.push(row);
      }
      return out;
    }

    function splitCSVLine(line){
      const res = [];
      let cur = "";
      let inQ = false;
      for(let i=0;i<line.length;i++){
        const ch = line[i];
        if(ch === '"' ){
          if(inQ && line[i+1] === '"'){ cur += '"'; i++; }
          else inQ = !inQ;
        } else if(ch === "," && !inQ){
          res.push(cur); cur="";
        } else {
          cur += ch;
        }
      }
      res.push(cur);
      return res;
    }

    // ---------- INIT ----------
    $("#year").textContent = new Date().getFullYear();
    renderTable();
    buildChart();
  </script>
</body>
</html>
